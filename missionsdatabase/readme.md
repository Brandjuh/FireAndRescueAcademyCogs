# MissionsDatabase Cog

Automatically sync MissionChief missions to a Discord forum with proper tagging, rate limiting, and comprehensive formatting.

## Features

- ✅ Automatic daily sync at 3:00 AM
- ✅ Smart tag system (12 tags total, max 5 per mission)
- ✅ Rate limiting to prevent Discord API issues
- ✅ Change detection with hash comparison
- ✅ Comprehensive mission formatting
- ✅ Support for all mission types (Fire, Police, EMS, etc.)

## Installation

```
[p]repo add faracogs https://github.com/Brandjuh/FireAndRescueAcademyCogs
[p]cog install faracogs missionsdatabase
[p]load missionsdatabase
```

## Setup

### 1. Create Forum Tags

Create these tags in your Discord forum channel (Settings > Tags):

1. **Missions** (always applied)
2. Fire
3. Police
4. EMS
5. Urban
6. Rural
7. Water
8. Hazmat
9. Mass Casualty
10. Technical
11. Wildfire
12. Specialized

### 2. Configure the Cog

```
[p]missions setup #missions-forum [#admin-alerts]
```

- `#missions-forum`: Forum channel where missions will be posted
- `#admin-alerts`: (Optional) Channel for error notifications

### 3. Start Syncing

```
[p]missions sync
```

This will perform the first sync. Subsequent syncs run automatically at 3:00 AM daily.

## Commands

### Setup & Configuration
- `[p]missions setup <forum_channel> [admin_channel]` - Initial configuration
- `[p]missions toggle` - Enable/disable automatic syncing
- `[p]missions ratelimit [posts_per_batch] [batch_delay] [post_delay]` - Configure rate limiting

### Syncing
- `[p]missions sync` - Manual sync
- `[p]missions update <mission_id>` - Force update specific mission
- `[p]missions view <mission_id>` - Preview mission formatting

### Management
- `[p]missions check` - View statistics
- `[p]missions deleteall` - Delete all forum posts (keeps database)
- `[p]missions fullreset` - Complete reset (database + optional forum posts)

## Tag System

The cog uses a compact 12-tag system with intelligent mapping:

| Mission Category | Discord Tag |
|------------------|-------------|
| fire | Fire |
| police | Police |
| ems | EMS |
| urban | Urban |
| rural | Rural |
| water_damage_and_flood, water_rescue, flood | Water |
| hazmat | Hazmat |
| mass_casualty | Mass Casualty |
| technical_rescue, tow_trucks | Technical |
| wildfire, forest | Wildfire |
| highway, aviation, federal_police, swat, marine, airport | Specialized |

Each mission receives:
- The "Missions" tag (always)
- Up to 4 category-specific tags

## Mission Format

Missions are formatted with comprehensive information:

```
**Mission Name**

**ID:** 88/A • **Avg. Credits:** 7,800
**Categories:** Fire | Urban | Water Damage & Flood

**Generated by:** Fire Station

**Unlocks at:**
- 5 Fire Stations
- 3 Rescue Stations
- 1 Disaster Response Ext.

**Required Personnel Training:**
- 6 HazMat

**Vehicle Requirements:**
- 2 Platform Trucks
- 2 Battalion Chief Vehicles

**Equipment Requirements:**
- 1 Light Tower Equipment

**Patients:**
- Up to 2
- Required Spec: General Surgeon
- Transport: ALS required
- US Codes: 22-D-3

**Chances:**
- 30% chance of hospital transport

**POI:** Various
```

## Rate Limiting

Default settings (configurable):
- 1 second between individual posts
- 11 seconds after every 5 posts
- 5 posts per batch

These settings prevent Discord API rate limits during large syncs.

## Troubleshooting

### "Module not found" error
Ensure the file is named `missions_database.py` (with 's'), not `mission_database.py`.

### Tags not applying
Check that the tags exist in the forum channel with exact names (case-sensitive).

### Slow sync
First sync of 500+ missions takes ~15-20 minutes due to rate limiting. This is normal and protects against API bans.

## Support

For issues or questions, contact Roel (Brandjuh) or open an issue on GitHub.
